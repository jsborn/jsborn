/*!
 * JSBorn (http://jsborn.org)
 * The best jQuery plugin to modular JavaScript and depend file.
 *
 * @version     v0.5.3, built on 2014-07-18 11:02:43 PM
 * @author      tureki https://twitter.com/tureki
 * @copyright   (c) 2013 - 2014 Tureki
 * @license     Apache-2.0
 */
!function(a){var b=jQuery,c=b.fn.jquery.split("."),d=1==c[0]&&c[1]<7?"bind":"on",e=1==c[0]&&c[1]<7?"unbind":"off",f={version:"0.5.3",status:"ready",event:{on:d,off:e},data:{cores:{},clss:{},plugins:{},imports:{},loads:[]},config:{console:!1,imports:{cache:!1,path:"",parser:{jsborn:""}}},addEventListener:function(a,c,d){return b(_j)[_j.event.on]("jsb."+a,{scope:d},c),this},classReady:function(a,b,c){var d=!1,e=!0,f=_j._get_cls(a);if(f){if(d=f.status,d.extend!==!0&&(e=!1),d.plugins!==!0&&(e=!1),d.css!==!0&&(e=!1),d.tpl!==!0&&(e=!1),d.imports!==!0&&(e=!1),f.fileRequire<=0&&0==e&&c)return c.call(),!1}else e=!1;return b?(e?b.call():_j.ready(b,c,a),!0):e},cls:function(a,c){if(_j._get_cls(a))return _j.echo("warn","JSB_ERROR_CLASS_DEFINE","CLASS:'"+a+"' define again"),!1;f.status="progress";var d=function(d){return c.plugins=c.plugins?c.plugins:[],this.className=a,this.__plugins=b.extend([],this.plugins,c.plugins),this.__extend=[],this.__count=0,this.__destroy=!1,this._extend(this),this._plugin(),this.initialize(d),this.SUPER(),delete this.__count,!0};if(_j.data.clss[a]={cls:d,config:{name:a,single:c.single?!0:!1,abstr:c.abstr?!0:!1},ready:!1,fileRequire:0,fileLoad:0,extend:c.extend?c.extend:!1,plugins:c.plugins?c.plugins.slice():[],status:{extend:c.extend?[c.extend]:!0,plugins:c.plugins?c.plugins.slice():!0,css:c.css?c.css.slice():!0,tpl:c.tpl?c.tpl.slice():!0,imports:c.imports?c.imports.slice():!0}},_j._file_require_count(a),b.extend(d.prototype,_j.cls.prototype,c),f.getImportData()[a]&&_j._check_cls_status(a),c.imports)for(var e=0;e<c.imports.length;e++)_j._parser_imports(a,c.imports[e]);if(c.extend&&(_j._check_cls_infite("extend",c.extend,a)?_j._parser_extend(d,c,a,c.extend):(_j.echo("error",a,"Extend: infinite loop."),_j._set_cls_status(a,"fail",c.extend))),c.plugins)for(var e=0;e<c.plugins.length;e++){var g=c.plugins[e];_j._check_cls_infite("plugins",g,a)?_j._parser_plugin(a,g):(_j.echo("error",a,"PLUGIN: infinite loop."),_j._set_cls_status(a,"fail",g))}if(c.tpl)for(var e=0;e<c.tpl.length;e++)_j._parser_tpl(a,c.tpl[e]);if(c.css)for(var e=0;e<c.css.length;e++)_j._parser_css(a,c.css[e]);return setTimeout(function(){_j._check_cls_status(a)},1),_j.data.clss[a]},create:function(a,c,d){var e=this,f=e._get_cls(a);if(!f)return e.echo("error","JSB_ERROR_CREATE","CLASS:"+a+" NOT FIND"),!1;if(!_j.classReady(a))return e.echo("error","JSB_ERROR_CREATE","CLASS:"+a+" NOT READY"),!1;if(f.config.abstr)return e.echo("error","JSB_ERROR_CREATE","CLASS:"+a+" ABSTR"),!1;if(f.config.nodes||(f.config.nodes=[]),f.config.single&&f.config.nodes.length>0)return e.echo("error","JSB_ERROR_CREATE","CLASS:"+a+" SINGLE"),!1;var g=new f.cls(c);return f.config.nodes.push(g),d&&b(e).triggerHandler("jsb.create",g),g},dispatchEvent:function(a,c){b(_j).triggerHandler("jsb."+a,[c])},echo:function(a,b,c){_j.dispatchEvent("log",{type:a,message:b,detail:c})},extendCore:function(c,d){var e=c.split("."),f=d.config.name;if(_j._get_core(c))return _j.echo("log","JSB_ERROR_EXTEND_CORE","Core: "+c+" already register."),!1;d.config=b.extend(d.config,{single:!0,abstr:!1});for(var g=0;g<e.length;g++){var h=h?h:a;if(g==e.length-1)return h[e[g]]=_j.create(f,{},!1),_j.data.cores[c]=h[e[g]],h[e[g]];b.isEmptyObject(h[e[g]])&&(h[e[g]]=new Object),h=h[e[g]]}},extendPlugin:function(a,b){var c=this,d=b.config.name,e=c.data.plugins;for(var f in e)if(e[f].name==a)return c.echo("error","JSB_ERROR_EXTEND_PLUGIN","[Plugin] Name Space: '"+a+"' define again."),!1;return c._get_plugin(d)?(c.echo("warn","JSB_ERROR_EXTEND_PLUGIN","Plugin: "+b+" already register."),c._get_plugin(d)):(c.data.plugins[d]={name:a,cls:b.cls},c.data.plugins[d])},getClassData:function(a){return a?_j.data.clss[a]:_j.data.clss},getImportData:function(a){return a?_j.data.imports[a]:_j.data.imports},importClass:function(a,c,d){for(var e=b.isArray(a)?a:[a],f=[],g=0;g<e.length;g++)_j.data.imports[e[g]]||f.push(_j._xhr(e[g]));f.length>0?b.when.apply(b,f).then(function(){b.isFunction(c)&&c.call()},function(){b.isFunction(d)&&d.call()}):b.isFunction(c)&&c.call()},removeEventListener:function(a,c){b(_j)[_j.event.off]("jsb."+a,c)},ready:function(a,c,d){if(d=d?d:"ready","ready"==d&&"complete"==f.status)return a.call(),!0;var e=function(){_j.removeEventListener(d,e),_j.removeEventListener(d+"::ERROR",g),b.isFunction(a)&&a.call()},g=function(){_j.removeEventListener(d,e),_j.removeEventListener(d+"::ERROR",g),b.isFunction(c)&&c.call()};_j.addEventListener(d,e),_j.addEventListener(d+"::ERROR",g)},setConfig:function(a){var c=this;return c.config=b.extend(!0,c.config,a),c.config},_check_cls_infite:function(a,c,d){var e=_j.data.clss[c];if(!e)return!0;if(e[a])for(var f=b.isArray(e[a])?e[a]:[e[a]],g=0;g<f.length;g++){if(f[g]==d)return!1;if(!_j._check_cls_infite(a,f[g],d))return!1}return!0},_check_cls_status:function(a){if(_j.classReady(a))_j._get_cls(a).ready=!0,_j.dispatchEvent(a,a);else{{var c=_j._get_cls(a).fileRequire;JSON.stringify(_j.data.clss),JSON.stringify(_j.data.imports)}0==c?(console.log("classError:",a),_j.dispatchEvent(a+"::ERROR")):_j._check_cls_repeat(a)}var d=!0;b.each(_j.getClassData(),function(a,b){_j.classReady(a)||b.ready||(d=!1)}),d?(f.status="complete",_j.dispatchEvent("ready")):_j._file_all_load()&&(f.status="fail",_j.dispatchEvent("ready::ERROR"))},_check_cls_repeat:function(a){if(_j._check_last_cls(a)){var b=_j.data.clss[a].status;if(b.imports!==!0)for(var c=0;c<b.imports.length;c++){var d=b.imports[c],e=_j.data.imports[d];e&&"success"==e.status&&(_j._update_cls_status(a,"imports",d),_j._file_require_decrease(a),_j._check_cls_status(a))}if(b.plugins!==!0)for(var c=0;c<b.plugins.length;c++){var d=b.plugins[c],e=_j.data.imports[d];e&&"success"==e.status&&(_j._update_cls_status(a,"plugins",d),_j._file_require_decrease(a),_j._check_cls_status(a))}if(b.extend!==!0)for(var c=0;c<b.extend.length;c++){var d=b.extend[c],e=_j.data.imports[d];e&&"success"==e.status&&(_j._update_cls_status(a,"extend",d),_j._file_require_decrease(a),_j._check_cls_status(a))}}},_check_last_cls:function(a){if(_j.data.imports[a])for(var b=_j.data.loads,c=b.length-1;c>=0;c--){var d=b[c];if(d==a)return!0;var e=_j.data.imports[d];if("success"!=e.status)return!1}return!1},_file_all_load:function(){var a=!0;return b.each(_j.getClassData(),function(b,c){c.fileRequire>0&&(a=!1)}),a},_file_require_count:function(a){var c=this,d=0,e=c.data.clss[a];for(var f in e.status)b.isArray(e.status[f])&&(d+=e.status[f].length);e.fileRequire=d},_file_require_decrease:function(a){var b=this,c=b.data.clss[a];c.fileRequire--},_get_core:function(a){var b=this;return b.data.cores[a]?b.data.cores[a]:!1},_get_cls:function(a){var b=this;return b.data.clss[a]?b.data.clss[a]:!1},_get_plugin:function(a){var b=this;return b.data.plugins[a]?b.data.plugins[a]:!1},_init_cls:function(){_j.cls.prototype={_plugin:function(){var a=[];if(b.each(this.__plugins,function(c,d){-1==b.inArray(d,a)&&_j.className!=d&&a.push(d)}),b.isArray(a))for(var c=0;c<a.length;c++){var d=_j._get_plugin(a[c]);this[d.name]=_j.create(a[c],this,!1)}},_extend:function(a){var b=a.extend;if(b){this.__extend.push(a.extend);var c=_j._get_cls(b).cls;c.prototype&&this._extend(c.prototype)}},SUPER:function(){if(this.__extend.length>0&&this.__count<this.__extend.length){var a=this.__extend[this.__count];if(a){var b=_j._get_cls(a).cls.prototype;this.__count++,b.initialize.apply(this,arguments),b.extend&&this.SUPER()}}},destroy:function(){if(this.__destroy)return _j.echo("error","JSB_ERROR_CLASS_DESTROY","Class:"+this.className+" already destroy."),!0;for(var a=_j._get_cls(this.className),c=0;c<a.config.nodes.length;c++)a.config.nodes[c]==this&&a.config.nodes.splice(c,1);return b(this).triggerHandler("cls.destroy",this),b(_j).triggerHandler("jsb.destroy",this),this.__destroy=!0,this},addEventListener:function(a,c,d){b(this)[_j.event.on]("cls."+a,{scope:d},c)},dispatchEvent:function(a,c){b(this).triggerHandler("cls."+a,[this,c])},getTpl:function(a,c){var d=a?"script#"+a:"",e=c?c:this.className;return b("head").find(d+'[jsb-tpl="'+e+'"]')},getCss:function(a){var c=a?a:this.className;return b("head").find('[jsb-css="'+c+'"]')},removeEventListener:function(a){b(this)[_j.event.off]("cls."+a)}}},_parser_callback:function(a,b,c,d){var e=_j.data.imports[b];_j._get_cls(b)||e?_j.classReady(b,function(){c.call()},function(){d.call()}):_j.importClass(b,function(){_j.classReady(b,function(){c.call()},function(){d.call()})},function(){d.call()})},_parser_imports:function(a,b){_j._parser_callback(a,b,function(){_j._set_cls_status(a,"imports",b)},function(){_j._set_cls_status(a,"fail",b)})},_parser_extend:function(a,c,d,e){_j._parser_callback(d,e,function(){b.extend(a.prototype,_j.cls.prototype,_j._get_cls(e).cls.prototype,c),_j._set_cls_status(d,"extend",e)},function(){_j._set_cls_status(d,"fail",e)})},_parser_plugin:function(a,b){_j._parser_callback(a,b,function(){_j._set_cls_status(a,"plugins",b)},function(){_j._set_cls_status(a,"fail",b)})},_parser_css:function(a,c){b.ajax({type:"GET",cache:!1,dataType:"text",url:_j._parser_url(c)}).done(function(d){var e=document.createElement("style");b(e).attr("type","text/css").attr("jsb-css",a),e.styleSheet?e.styleSheet.cssText=d:e.innerHTML=d,b(e).appendTo("head"),_j._set_cls_status(a,"css",c)}).fail(function(){_j._set_cls_status(a,"fail",c)})},_parser_tpl:function(a,c){b.ajax({type:"GET",cache:!1,dataType:"html",url:_j._parser_url(c)}).done(function(d){var e=b(d);e.attr("jsb-tpl",a),e.appendTo("head"),_j._set_cls_status(a,"tpl",c)}).fail(function(){_j._set_cls_status(a,"fail",c)})},_parser_url:function(a,c){var d=_j.config.imports,e="",f=d.path;if(!b.isEmptyObject(d.parser)){var g=0;for(key in d.parser){var h=new RegExp("^"+key,"g");if(a.match(h)&&key.length>g){var i=d.parser[key];f=i.path?i.path:i,g=key.length}}}return e=f+a+(c?c:""),i&&b.isFunction(i.parser)&&(e=i.parser.call(i,e)),e},_set_cls_status:function(a,b,c){"fail"!=b?_j._update_cls_status(a,b,c):_j.dispatchEvent(c+"::ERROR"),this._file_require_decrease(a),_j._check_cls_status(a)},_update_cls_status:function(a,b,c){for(var d=_j._get_cls(a).status[b],e=0;e<d.length;e++)if(d[e]==c){d.splice(e,1);break}_j._get_cls(a).status[b]=d.length>0?d:!0},_xhr:function(a){return _str_url=_j._parser_url(a,".js"),_j.data.imports[a]={status:"progress"},_j.data.loads.push(a),b.ajax({url:_str_url,dataType:"script",cache:_j.config.imports.cache}).done(function(){_j.data.imports[a].status="success"}).fail(function(b,c,d){_j.data.imports[a].status="fail",_j.echo("error","JSB_ERROR_CLASS_IMPORT","Require:"+_str_url+" Message:"+d)})}};a.JSB=f,a.jsb||(a.jsb=f),a._j||(a._j=f),f._init_cls()}(window);