/*!
 * JSBorn (http://jsborn.org)
 * The best jQuery plugin to modular JavaScript and depend file.
 *
 * @version     v0.5.3, built on 2014-07-23 6:29:55 PM
 * @author      tureki https://twitter.com/tureki
 * @copyright   (c) 2013 - 2014 Tureki
 * @license     Apache-2.0
 */
!function(a){var b=$.fn.jquery.split("."),c=parseInt(b[0],10),d=1===c&&b[1]<7?"bind":"on",e=1===c&&b[1]<7?"unbind":"off",f={version:"0.5.3",status:"ready",errors:["JSB_ERROR_CLASS_DEFINE","JSB_ERROR_CLASS_DESTROY","JSB_ERROR_CLASS_IMPORT","JSB_ERROR_CREATE","JSB_ERROR_EXTEND_CORE","JSB_ERROR_EXTEND_PLUGIN"],event:{on:d,off:e},data:{cores:{},clss:{},plugins:{},imports:{},loads:[]},config:{imports:{cache:!1,path:"",parser:{jsborn:""}}},addEventListener:function(a,b,c){return $(f)[f.event.on]("jsb."+a,{scope:c},b),this},classReady:function(a,b,c){var d=!1,e=!0,g=f._get_cls(a);if(g){if(d=g.status,d.extend!==!0&&(e=!1),d.plugins!==!0&&(e=!1),d.css!==!0&&(e=!1),d.tpl!==!0&&(e=!1),d.imports!==!0&&(e=!1),g.fileRequire<=0&&e===!1&&c)return c.call(),!1}else e=!1;return b?(e?b.call():f._ready(b,c,a),!0):e},create:function(a,b,c){var d=f._get_cls(a);if(!d)return f._log("error",f.errors[3],"CLASS:"+a+" NOT FIND"),!1;if(!f.classReady(a))return f._log("error",f.errors[3],"CLASS:"+a+" NOT READY"),!1;if(d.config.abstr)return f._log("error",f.errors[3],"CLASS:"+a+" IS DEFINE AN ABSTR CLASS"),!1;if(d.config.nodes||(d.config.nodes=[]),d.config.single&&d.config.nodes.length>0)return f._log("error",f.errors[3],"CLASS:"+a+" SINGLE"),!1;var e=new d.cls(b);return d.config.nodes.push(e),c&&$(f).triggerHandler("jsb.create",e),e},define:function(a,b){var c;if(f._get_cls(a))return f._log("warn",f.errors[0],"CLASS:'"+a+"' define again"),!1;f.status="progress";var d=function(c){return b.plugins=b.plugins?b.plugins:[],this.__classname=a,this.__plugins=$.extend([],this.plugins,b.plugins),this.__extend=[],this.__count=0,this.__destroy=!1,this._extend(this),this._plugin(),this.initialize(c),this.SUPER(),delete this.__count,!0};if(f.data.clss[a]={cls:d,config:{name:a,single:b.single?!0:!1,abstr:b.abstr?!0:!1},ready:!1,fileRequire:0,fileLoad:0,extend:b.extend?b.extend:!1,plugins:b.plugins?b.plugins.slice():[],status:{extend:b.extend?[b.extend]:!0,plugins:b.plugins?b.plugins.slice():!0,css:b.css?b.css.slice():!0,tpl:b.tpl?b.tpl.slice():!0,imports:b.imports?b.imports.slice():!0}},f._file_require_count(a),$.extend(d.prototype,f.define.prototype,b),f.getImportData()[a]&&f._cls_status_dispatch(a),b.imports)for(c=0;c<b.imports.length;c++)f._parser_imports(a,b.imports[c]);if(b.extend&&(f._cls_infinite("extend",b.extend,a)?f._parser_extend(d,b,a,b.extend):(f._log("error",a,"Extend: infinite loop."),f._cls_status_set(a,"fail",b.extend))),b.plugins)for(c=0;c<b.plugins.length;c++){var e=b.plugins[c];f._cls_infinite("plugins",e,a)?f._parser_plugin(a,e):(f._log("error",a,"PLUGIN: infinite loop."),f._cls_status_set(a,"fail",e))}if(b.tpl)for(c=0;c<b.tpl.length;c++)f._parser_tpl(a,b.tpl[c]);if(b.css)for(c=0;c<b.css.length;c++)f._parser_css(a,b.css[c]);return setTimeout(function(){f._cls_status_dispatch(a)},1),f._get_cls(a)},dispatchEvent:function(a,b){$(f).triggerHandler("jsb."+a,[b])},getClassData:function(a){return a?f._get_cls(a):f.data.clss},getImportData:function(a){return a?f.data.imports[a]:f.data.imports},importClass:function(a,b,c){for(var d=$.isArray(a)?a:[a],e=[],g=0;g<d.length;g++)f.data.imports[d[g]]||e.push(f._xhr(d[g]));e.length>0?$.when.apply($,e).then(function(){$.isFunction(b)&&b.call()},function(){$.isFunction(c)&&c.call()}):$.isFunction(b)&&b.call()},ready:function(a,b){f._ready(a,b,"ready")},registerGlobal:function(b,c){var d=b.split("."),e=c.config.name;if(f.data.cores[b])return f._log("log",f.errors[4],"Core: "+b+" already register."),!1;c.config=$.extend(c.config,{single:!0,abstr:!1});for(var g=0;g<d.length;g++){var h=h?h:a;if(!(g<d.length-1))return h[d[g]]=f.create(e,{},!1),f.data.cores[b]=h[d[g]],h[d[g]];$.isEmptyObject(h[d[g]])&&(h[d[g]]={}),h=h[d[g]]}},registerPlugin:function(a,b){var c=b.config.name,d=f.data.plugins;for(var e in d)if(d[e].name===a)return f._log("error",f.errors[5],"[Plugin] Name Space: '"+a+"' define again."),!1;return f._get_plugin(c)?(f._log("warn",f.errors[5],"Plugin: "+b+" already register."),f._get_plugin(c)):(f.data.plugins[c]={name:a,cls:b.cls},f.data.plugins[c])},removeEventListener:function(a,b){$(f)[f.event.off]("jsb."+a,b)},setConfig:function(a){return f.config=$.extend(!0,f.config,a),f.config},_cls_infinite:function(a,b,c){var d=f._get_cls(b);if(!d)return!0;if(d[a])for(var e=$.isArray(d[a])?d[a]:[d[a]],g=0;g<e.length;g++){if(e[g]===c)return!1;if(!f._cls_infinite(a,e[g],c))return!1}return!0},_cls_is_last:function(a){if(f.data.imports[a])for(var b=f.data.loads,c=b.length-1;c>=0;c--){var d=b[c];if(d===a)return!0;var e=f.data.imports[d];if("success"!==e.status)return!1}return!1},_cls_status_check:function(a,b){var c,d,e=f._get_cls(a).status[b];if(e!==!0)for(i=0;i<e.length;i++)c=e[i],d=f.data.imports[c],d&&"success"===d.status&&(f._cls_status_update(a,b,c),f._file_require_decrease(a),f._cls_status_dispatch(a))},_cls_status_dispatch:function(a){var b=!0;if(f.classReady(a))f._get_cls(a).ready=!0,f.dispatchEvent(a,a);else{var c=f._get_cls(a).fileRequire;0===c?f.dispatchEvent(a+"::Error"):f._cls_is_last(a)&&(f._cls_status_check(a,"imports"),f._cls_status_check(a,"plugins"),f._cls_status_check(a,"extend"))}$.each(f.getClassData(),function(a,c){f.classReady(a)||c.ready||(b=!1)}),b?(f.status="complete",f.dispatchEvent("ready")):f._file_all_load()&&(f.status="fail",f.dispatchEvent("ready::Error"))},_cls_status_set:function(a,b,c){"fail"!==b?f._cls_status_update(a,b,c):f.dispatchEvent(c+"::Error"),f._file_require_decrease(a),f._cls_status_dispatch(a)},_cls_status_update:function(a,b,c){for(var d=f._get_cls(a).status[b],e=0;e<d.length;e++)if(d[e]===c){d.splice(e,1);break}f._get_cls(a).status[b]=d.length>0?d:!0},_file_all_load:function(){var a=!0;return $.each(f.getClassData(),function(b,c){c.fileRequire>0&&(a=!1)}),a},_file_require_count:function(a){var b=0,c=f._get_cls(a);for(var d in c.status)$.isArray(c.status[d])&&(b+=c.status[d].length);c.fileRequire=b},_file_require_decrease:function(a){var b=f._get_cls(a);b.fileRequire--},_get_cls:function(a){return f.data.clss[a]?f.data.clss[a]:!1},_get_plugin:function(a){return f.data.plugins[a]?f.data.plugins[a]:!1},_init_cls:function(){f.define.prototype={_plugin:function(){var a=[];if($.each(this.__plugins,function(b,c){-1===$.inArray(c,a)&&f.__classname!==c&&a.push(c)}),$.isArray(a))for(var b=0;b<a.length;b++){var c=f._get_plugin(a[b]);this[c.name]=f.create(a[b],this,!1)}},_extend:function(a){var b=a.extend;if(b){this.__extend.push(a.extend);var c=f._get_cls(b).cls;c.prototype&&this._extend(c.prototype)}},SUPER:function(){if(this.__extend.length>0&&this.__count<this.__extend.length){var a=this.__extend[this.__count];if(a){var b=f._get_cls(a).cls.prototype;this.__count++,b.initialize.apply(this,arguments),b.extend&&this.SUPER()}}},addEventListener:function(a,b,c){$(this)[f.event.on]("cls."+a,{scope:c},b)},destroy:function(){if(this.__destroy)return f._log("error",f.errors[1],"Class:"+this.__classname+" already destroy."),!0;for(var a=f._get_cls(this.__classname),b=0;b<a.config.nodes.length;b++)a.config.nodes[b]===this&&a.config.nodes.splice(b,1);return $(this).triggerHandler("cls.destroy",this),$(f).triggerHandler("jsb.destroy",this),this.__destroy=!0,this},dispatchEvent:function(a,b){$(this).triggerHandler("cls."+a,[this,b])},getCss:function(a){var b=a?a:this.__classname;return $("head").find('[jsb-css="'+b+'"]')},getName:function(){return this.__classname},getTpl:function(a,b){var c=a?"script#"+a:"",d=b?b:this.__classname;return $("head").find(c+'[jsb-tpl="'+d+'"]')},removeEventListener:function(a){$(this)[f.event.off]("cls."+a)}}},_log:function(a,b,c){f.dispatchEvent("log",{type:a,message:b,detail:c})},_parser_callback:function(a,b,c){var d=f.data.imports[a];f._get_cls(a)||d?f.classReady(a,function(){b.call()},function(){c.call()}):f.importClass(a,function(){f.classReady(a,function(){b.call()},function(){c.call()})},function(){c.call()})},_parser_imports:function(a,b){f._parser_callback(b,function(){f._cls_status_set(a,"imports",b)},function(){f._cls_status_set(a,"fail",b)})},_parser_extend:function(a,b,c,d){f._parser_callback(d,function(){$.extend(a.prototype,f.define.prototype,f._get_cls(d).cls.prototype,b),f._cls_status_set(c,"extend",d)},function(){f._cls_status_set(c,"fail",d)})},_parser_plugin:function(a,b){f._parser_callback(b,function(){f._cls_status_set(a,"plugins",b)},function(){f._cls_status_set(a,"fail",b)})},_parser_css:function(a,b){$.ajax({type:"GET",cache:!1,dataType:"text",url:f._parser_url(b)}).done(function(c){var d=document.createElement("style");$(d).attr("type","text/css").attr("jsb-css",a),d.styleSheet?d.styleSheet.cssText=c:d.innerHTML=c,$(d).appendTo("head"),f._cls_status_set(a,"css",b)}).fail(function(){f._cls_status_set(a,"fail",b)})},_parser_tpl:function(a,b){$.ajax({type:"GET",cache:!1,dataType:"html",url:f._parser_url(b)}).done(function(c){var d=$(c);d.attr("jsb-tpl",a),d.appendTo("head"),f._cls_status_set(a,"tpl",b)}).fail(function(){f._cls_status_set(a,"fail",b)})},_parser_url:function(a,b){var c,d=f.config.imports,e="",g=d.path;if(!$.isEmptyObject(d.parser)){var h=0;for(var i in d.parser){var j=new RegExp("^"+i,"g");a.match(j)&&i.length>h&&(c=d.parser[i],g=c.path?c.path:c,h=i.length)}}return e=g+a+(b?b:""),c&&$.isFunction(c.parser)&&(e=c.parser.call(c,e)),e},_ready:function(a,b,c){if("ready"===c&&"complete"===f.status)return a.call(),!0;var d=function(){f.removeEventListener(c,d),f.removeEventListener(c+"::Error",e),$.isFunction(a)&&a.call()},e=function(){f.removeEventListener(c,d),f.removeEventListener(c+"::Error",e),$.isFunction(b)&&b.call()};f.addEventListener(c,d),f.addEventListener(c+"::Error",e)},_xhr:function(a){return _str_url=f._parser_url(a,".js"),f.data.imports[a]={status:"progress"},f.data.loads.push(a),$.ajax({url:_str_url,dataType:"script",cache:f.config.imports.cache}).done(function(){f.data.imports[a].status="success"}).fail(function(b,c,d){f.data.imports[a].status="fail",f._log("error",f.errors[2],"Require:"+_str_url+" Message:"+d)})}};f._init_cls(),a._b=f,a.JSBorn=f}(window);