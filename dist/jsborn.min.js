/*!
 * JSBorn (http://jsborn.org)
 * The best jQuery plugin to modular JavaScript and depend file.
 *
 * @version     v0.5.3, built on 2014-07-24 5:10:01 PM
 * @author      tureki https://twitter.com/tureki
 * @copyright   (c) 2013 - 2014 Tureki
 * @license     Apache-2.0
 */
!function(a){var b=$.fn.jquery.split("."),c=parseInt(b[0],10),d={config:{imports:{cache:!1,path:"",parser:{jsborn:""}}},data:{cores:{},clss:{},plugins:{},imports:{},loads:[]},events:["log","create","destroy"],errors:["JSB_ERROR_CLASS_DEFINE","JSB_ERROR_CLASS_DESTROY","JSB_ERROR_CLASS_IMPORT","JSB_ERROR_CREATE","JSB_ERROR_EXTEND_CORE","JSB_ERROR_EXTEND_PLUGIN","JSB_ERROR_CLASS_INFINITE_LOOP"],on:1===c&&b[1]<7?"bind":"on",off:1===c&&b[1]<7?"unbind":"off",status:"ready",version:"0.5.3",addEventListener:function(a,b,c){return $(d)[d.on]("jsb."+a,{scope:c},b),d},classReady:function(a,b,c){var e=!1,f=!0,g=d._get_cls(a);if(g){if(e=g.status,(e.extend!==!0||e.plugins!==!0||e.css!==!0||e.tpl!==!0||e.imports!==!0)&&(f=!1),g.fileRequire<=0&&f===!1&&c)return c.call(),!1}else f=!1;return b?(f?b.call():d._ready(b,c,a),!0):f},create:function(a,b,c){var e=d._get_cls(a);if(!e)return d._log("error",d.errors[3],"[Class]:'"+a+"' not found."),!1;if(!d.classReady(a))return d._log("error",d.errors[3],"[Class]:'"+a+"' is not ready"),!1;if(e.config.abstr)return d._log("error",d.errors[3],"[Class]:'"+a+"' is an abstract class."),!1;if(e.config.nodes||(e.config.nodes=[]),e.config.single&&e.config.nodes.length>0)return d._log("error",d.errors[3],"[Class]:'"+a+"' is define as singleton."),!1;var f=new e.cls(b);return e.config.nodes.push(f),c&&$(d).triggerHandler("jsb."+d.events[1],f),f},define:function(a,b){var c;if(d._get_cls(a))return d._log("warning",d.errors[0],"[Class]:'"+a+"' define again."),!1;d.status="progress";var e=function(c){return b.plugins=b.plugins?b.plugins:[],this.__classname=a,this.__plugins=$.extend([],this.plugins,b.plugins),this.__extend=[],this.__count=0,this.__destroy=!1,this._extend(this),this._plugin(),this.initialize(c),this.SUPER(),delete this.__count,!0};if(d.data.clss[a]={cls:e,config:{name:a,single:b.single?!0:!1,abstr:b.abstr?!0:!1},ready:!1,fileRequire:0,fileLoad:0,extend:b.extend?b.extend:!1,plugins:b.plugins?b.plugins.slice():[],status:{extend:b.extend?[b.extend]:!0,plugins:b.plugins?b.plugins.slice():!0,css:b.css?b.css.slice():!0,tpl:b.tpl?b.tpl.slice():!0,imports:b.imports?b.imports.slice():!0}},d._file_require_count(a),$.extend(e.prototype,d.define.prototype,b),d.getImportData()[a]&&d._cls_status_dispatch(a),b.imports)for(c=0;c<b.imports.length;c++)d._parser_imports(a,b.imports[c]);if(b.extend&&(d._cls_infinite("extend",b.extend,a)?d._parser_extend(e,b,a,b.extend):(d._log("error",d.errors[6],"[Extend]: '"+a+"' infinite loop extend."),d._cls_status_set(a,"fail",b.extend))),b.plugins)for(c=0;c<b.plugins.length;c++){var f=b.plugins[c];d._cls_infinite("plugins",f,a)?d._parser_plugin(a,f):(d._log("error",d.errors[6],"[Plugin]: '"+a+"' infinite loop."),d._cls_status_set(a,"fail",f))}if(b.tpl)for(c=0;c<b.tpl.length;c++)d._parser_tpl(a,b.tpl[c]);if(b.css)for(c=0;c<b.css.length;c++)d._parser_css(a,b.css[c]);return setTimeout(function(){d._cls_status_dispatch(a)},1),d._get_cls(a)},dispatchEvent:function(a,b){return $(d).triggerHandler("jsb."+a,[b]),d},getClassData:function(a){return a?d._get_cls(a):d.data.clss},getImportData:function(a){return a?d.data.imports[a]:d.data.imports},importClass:function(a,b,c){for(var e=$.isArray(a)?a:[a],f=[],g=0;g<e.length;g++)d.data.imports[e[g]]||f.push(d._xhr(e[g]));f.length>0?$.when.apply($,f).then(function(){$.isFunction(b)&&b.call()},function(a){$.isFunction(c)&&c.call(),d._log("error",d.errors[2],"[Import] error:'"+a.statusText+"' text:"+a.responseText)}):$.isFunction(b)&&b.call()},ready:function(a,b){d._ready(a,b,"ready")},registerGlobal:function(b,c){var e=b.split("."),f=c.config.name;if(d.data.cores[b])return d._log("info",d.errors[4],"[Global]: namespace '"+b+"' already register."),!1;c.config=$.extend(c.config,{single:!0,abstr:!1});for(var g=0;g<e.length;g++){var h=h?h:a;if(!(g<e.length-1))return h[e[g]]=d.create(f,{},!1),d.data.cores[b]=h[e[g]],h[e[g]];$.isEmptyObject(h[e[g]])&&(h[e[g]]={}),h=h[e[g]]}},registerPlugin:function(a,b){var c=b.config.name,e=d.data.plugins;for(var f in e)if(e[f].name===a)return d._log("error",d.errors[5],"[Plugin]: namespace '"+a+"' define again."),!1;return d._get_plugin(c)?(d._log("warning",d.errors[5],"[Plugin]: '"+b+"' already register in another namespace."),d._get_plugin(c)):(d.data.plugins[c]={name:a,cls:b.cls},d.data.plugins[c])},removeEventListener:function(a,b){return $(d)[d.off]("jsb."+a,b),d},setConfig:function(a){return d.config=$.extend(!0,d.config,a),d},_cls_infinite:function(a,b,c){var e=d._get_cls(b);if(!e)return!0;if(e[a])for(var f=$.isArray(e[a])?e[a]:[e[a]],g=0;g<f.length;g++){if(f[g]===c)return!1;if(!d._cls_infinite(a,f[g],c))return!1}return!0},_cls_is_last:function(a){if(d.data.imports[a])for(var b=d.data.loads,c=b.length-1;c>=0;c--){var e=b[c];if(e===a)return!0;var f=d.data.imports[e];if("success"!==f.status)return!1}return!1},_cls_status_check:function(a,b){var c,e,f=d._get_cls(a).status[b];if(f!==!0)for(i=0;i<f.length;i++)c=f[i],e=d.data.imports[c],e&&"success"===e.status&&(d._cls_status_update(a,b,c),d._file_require_decrease(a),d._cls_status_dispatch(a))},_cls_status_dispatch:function(a){var b=!0;if(d.classReady(a))d._get_cls(a).ready=!0,d.dispatchEvent(a,a);else{var c=d._get_cls(a).fileRequire;0===c?d.dispatchEvent(a+"::Error"):d._cls_is_last(a)&&(d._cls_status_check(a,"imports"),d._cls_status_check(a,"plugins"),d._cls_status_check(a,"extend"))}$.each(d.getClassData(),function(a,c){d.classReady(a)||c.ready||(b=!1)}),b?(d.status="complete",d.dispatchEvent("ready")):d._file_all_load()&&(d.status="fail",d.dispatchEvent("ready::Error"))},_cls_status_set:function(a,b,c){"fail"!==b?d._cls_status_update(a,b,c):d.dispatchEvent(c+"::Error"),d._file_require_decrease(a),d._cls_status_dispatch(a)},_cls_status_update:function(a,b,c){for(var e=d._get_cls(a).status[b],f=0;f<e.length;f++)if(e[f]===c){e.splice(f,1);break}d._get_cls(a).status[b]=e.length>0?e:!0},_file_all_load:function(){var a=!0;return $.each(d.getClassData(),function(b,c){c.fileRequire>0&&(a=!1)}),a},_file_require_count:function(a){var b=0,c=d._get_cls(a);for(var e in c.status)$.isArray(c.status[e])&&(b+=c.status[e].length);c.fileRequire=b},_file_require_decrease:function(a){var b=d._get_cls(a);b.fileRequire--},_get_cls:function(a){return d.data.clss[a]?d.data.clss[a]:!1},_get_plugin:function(a){return d.data.plugins[a]?d.data.plugins[a]:!1},_init_cls:function(){d.define.prototype={SUPER:function(){if(this.__extend.length>0&&this.__count<this.__extend.length){var a=this.__extend[this.__count];if(a){var b=d._get_cls(a).cls.prototype;this.__count++,b.initialize.apply(this,arguments),b.extend&&this.SUPER()}}},addEventListener:function(a,b,c){return $(this)[d.on]("cls."+a,{scope:c},b),this},destroy:function(){if(this.__destroy)return d._log("error",d.errors[1],"[Class]:'"+this.__classname+"' already destroy."),!0;for(var a=d._get_cls(this.__classname),b=0;b<a.config.nodes.length;b++)a.config.nodes[b]===this&&a.config.nodes.splice(b,1);return $(this).triggerHandler("cls."+d.events[2],this),$(d).triggerHandler("jsb."+d.events[2],this),this.__destroy=!0,this},dispatchEvent:function(a,b){return $(this).triggerHandler("cls."+a,[this,b]),this},getCss:function(a){var b=a?a:this.__classname;return $("head").find('[jsb-css="'+b+'"]')},getName:function(){return this.__classname},getTpl:function(a,b){var c=a?'script[data-tpl-name="'+a+'"]':"",d=b?b:this.__classname;return $("head").find(c+'[jsb-tpl="'+d+'"]')},removeEventListener:function(a){return $(this)[d.off]("cls."+a),this},_plugin:function(){var a=[];if($.each(this.__plugins,function(b,c){-1===$.inArray(c,a)&&d.__classname!==c&&a.push(c)}),$.isArray(a))for(var b=0;b<a.length;b++){var c=d._get_plugin(a[b]);this[c.name]=d.create(a[b],this,!1)}},_extend:function(a){var b=a.extend;if(b){this.__extend.push(a.extend);var c=d._get_cls(b).cls;c.prototype&&this._extend(c.prototype)}}}},_log:function(a,b,c){d.dispatchEvent(d.events[0],{type:a,message:b,detail:c})},_parser_callback:function(a,b,c){var e=d.data.imports[a];d._get_cls(a)||e?d.classReady(a,function(){b.call()},function(){c.call()}):d.importClass(a,function(){d.classReady(a,function(){b.call()},function(){c.call()})},function(){c.call()})},_parser_imports:function(a,b){d._parser_callback(b,function(){d._cls_status_set(a,"imports",b)},function(){d._cls_status_set(a,"fail",b)})},_parser_extend:function(a,b,c,e){d._parser_callback(e,function(){$.extend(a.prototype,d.define.prototype,d._get_cls(e).cls.prototype,b),d._cls_status_set(c,"extend",e)},function(){d._cls_status_set(c,"fail",e)})},_parser_plugin:function(a,b){d._parser_callback(b,function(){d._cls_status_set(a,"plugins",b)},function(){d._cls_status_set(a,"fail",b)})},_parser_css:function(a,b){$.ajax({type:"GET",cache:!1,dataType:"text",url:d._parser_url(b)}).done(function(c){var e=document.createElement("style");$(e).attr("type","text/css").attr("jsb-css",a),e.styleSheet?e.styleSheet.cssText=c:e.innerHTML=c,$(e).appendTo("head"),d._cls_status_set(a,"css",b)}).fail(function(){d._cls_status_set(a,"fail",b)})},_parser_tpl:function(a,b){$.ajax({type:"GET",cache:!1,dataType:"html",url:d._parser_url(b)}).done(function(c){var e=$(c);e.attr("jsb-tpl",a),e.appendTo("head"),d._cls_status_set(a,"tpl",b)}).fail(function(){d._cls_status_set(a,"fail",b)})},_parser_url:function(a,b){var c,e=d.config.imports,f="",g=e.path;if(!$.isEmptyObject(e.parser)){var h=0;for(var i in e.parser)a.match(new RegExp("^"+i,"g"))&&i.length>h&&(c=e.parser[i],g=c.path?c.path:c,h=i.length)}return f=g+a+(b?b:""),c&&$.isFunction(c.parser)&&(f=c.parser.call(c,f)),f},_ready:function(a,b,c){if("ready"===c&&"complete"===d.status)return a.call(),!0;var e=function(){d.removeEventListener(c,e),d.removeEventListener(c+"::Error",f),$.isFunction(a)&&a.call()},f=function(){d.removeEventListener(c,e),d.removeEventListener(c+"::Error",f),$.isFunction(b)&&b.call()};d.addEventListener(c,e),d.addEventListener(c+"::Error",f)},_xhr:function(a){return _str_url=d._parser_url(a,".js"),d.data.imports[a]={status:"progress"},d.data.loads.push(a),$.ajax({url:_str_url,dataType:"script",cache:d.config.imports.cache}).done(function(){d.data.imports[a].status="success"}).fail(function(b,c,e){d.data.imports[a].status="fail",d._log("error",d.errors[2],"[XHR]:file:'"+_str_url+"' import error. [Message]:"+e)})}};d._init_cls(),a._b=d,a.JSBorn=d}(window);